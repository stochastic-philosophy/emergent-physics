<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Android Debug Console</title>
    
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Segoe UI', sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
            padding: 10px;
            font-size: 14px;
        }
        
        .debug-header {
            background: #2d2d2d;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #ff6b35;
        }
        
        .debug-header h1 {
            color: #ff6b35;
            font-size: 1.5rem;
            margin-bottom: 8px;
        }
        
        .debug-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .debug-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background 0.3s;
        }
        
        .debug-btn:hover, .debug-btn:active {
            background: #45a049;
        }
        
        .debug-btn.clear { background: #f44336; }
        .debug-btn.clear:hover { background: #da190b; }
        
        .debug-btn.test { background: #2196F3; }
        .debug-btn.test:hover { background: #1976D2; }
        
        .console-output {
            background: #0a0a0a;
            border: 2px solid #333;
            border-radius: 8px;
            padding: 15px;
            min-height: 400px;
            max-height: 60vh;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.4;
        }
        
        .log-entry {
            margin-bottom: 8px;
            padding: 6px 10px;
            border-radius: 4px;
            border-left: 3px solid #666;
        }
        
        .log-info {
            color: #2196F3;
            background: rgba(33, 150, 243, 0.1);
            border-left-color: #2196F3;
        }
        
        .log-warn {
            color: #FF9800;
            background: rgba(255, 152, 0, 0.1);
            border-left-color: #FF9800;
        }
        
        .log-error {
            color: #f44336;
            background: rgba(244, 67, 54, 0.1);
            border-left-color: #f44336;
            font-weight: bold;
        }
        
        .log-success {
            color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
            border-left-color: #4CAF50;
        }
        
        .log-timestamp {
            color: #888;
            font-size: 11px;
            margin-right: 8px;
        }
        
        .stats-panel {
            background: #2d2d2d;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4CAF50;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #bbb;
            margin-top: 4px;
        }
        
        .back-link {
            display: inline-block;
            margin-top: 20px;
            color: #4CAF50;
            text-decoration: none;
            padding: 10px 15px;
            background: #2d2d2d;
            border-radius: 6px;
            border: 1px solid #4CAF50;
        }
        
        /* Tabletti-optimointi */
        @media (max-width: 768px) {
            body { padding: 8px; font-size: 13px; }
            .debug-header { padding: 12px; }
            .debug-header h1 { font-size: 1.3rem; }
            .debug-controls { grid-template-columns: repeat(2, 1fr); }
            .debug-btn { padding: 14px 12px; font-size: 13px; }
            .console-output { max-height: 50vh; font-size: 12px; }
        }
    </style>
</head>
<body>
    <div class="debug-header">
        <h1>üì± Android Debug Console</h1>
        <p>Tabletti-yst√§v√§llinen console.log n√§ytt√∂ ja PDF-debugging</p>
    </div>

    <div class="debug-controls">
        <button class="debug-btn test" onclick="testBasicFunctions()">üß™ Test Basic</button>
        <button class="debug-btn test" onclick="testPDFModules()">üìÑ Test PDF</button>
        <button class="debug-btn test" onclick="testMemoryUsage()">üíæ Memory</button>
        <button class="debug-btn" onclick="goToMainSite()">üè† Main Site</button>
        <button class="debug-btn clear" onclick="clearConsole()">üóëÔ∏è Clear</button>
        <button class="debug-btn" onclick="exportLogs()">üì§ Export</button>
    </div>

    <div id="console-output" class="console-output">
        <div class="log-entry log-info">
            <span class="log-timestamp">[INIT]</span>
            Android Debug Console loaded - Ready for debugging!
        </div>
    </div>

    <div class="stats-panel">
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-value" id="log-count">0</div>
                <div class="stat-label">Log Entries</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="error-count">0</div>
                <div class="stat-label">Errors</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="memory-usage">0 MB</div>
                <div class="stat-label">Memory Usage</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="session-time">0s</div>
                <div class="stat-label">Session Time</div>
            </div>
        </div>
    </div>

    <a href="index.html" class="back-link">‚Üê Takaisin p√§√§sivulle</a>

    <script>
        // Global state
        let logCount = 0;
        let errorCount = 0;
        let sessionStart = Date.now();
        let logEntries = [];

        // Override console methods to capture output
        const originalConsole = {
            log: console.log.bind(console),
            warn: console.warn.bind(console),
            error: console.error.bind(console),
            info: console.info.bind(console)
        };

        // Custom debug logger that shows on screen
        window.AndroidDebug = {
            log: function(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const logElement = document.createElement('div');
                logElement.className = `log-entry log-${type}`;
                
                const messageStr = typeof message === 'object' ? JSON.stringify(message, null, 2) : String(message);
                logElement.innerHTML = `
                    <span class="log-timestamp">[${timestamp}]</span>
                    ${messageStr}
                `;
                
                const consoleOutput = document.getElementById('console-output');
                consoleOutput.appendChild(logElement);
                consoleOutput.scrollTop = consoleOutput.scrollHeight;
                
                // Update stats
                logCount++;
                if (type === 'error') errorCount++;
                updateStats();
                
                // Store for export
                logEntries.push({
                    timestamp: timestamp,
                    type: type,
                    message: messageStr
                });
                
                // Also log to original console
                if (originalConsole[type]) {
                    originalConsole[type](message);
                } else {
                    originalConsole.log(`[${type.toUpperCase()}] ${messageStr}`);
                }
            },
            
            info: function(message) { this.log(message, 'info'); },
            warn: function(message) { this.log(message, 'warn'); },
            error: function(message) { this.log(message, 'error'); },
            success: function(message) { this.log(message, 'success'); }
        };

        // Override console methods to use our logger
        console.log = function(...args) {
            AndroidDebug.info(args.join(' '));
        };

        console.warn = function(...args) {
            AndroidDebug.warn(args.join(' '));
        };

        console.error = function(...args) {
            AndroidDebug.error(args.join(' '));
        };

        console.info = function(...args) {
            AndroidDebug.info(args.join(' '));
        };

        // Capture all errors
        window.addEventListener('error', function(e) {
            AndroidDebug.error(`Global Error: ${e.message} at ${e.filename}:${e.lineno}`);
        });

        window.addEventListener('unhandledrejection', function(e) {
            AndroidDebug.error(`Unhandled Promise: ${e.reason}`);
        });

        // Test functions
        function testBasicFunctions() {
            AndroidDebug.info('=== TESTING BASIC FUNCTIONS ===');
            
            // Test window objects with more detailed info
            const modules = [
                'Utils', 'Storage', 'UI', 'ThemeManager',
                'FileManager', 'MarkdownProcessor', 'ProjectManager',
                'ContentRenderer', 'PDFGenerator', 'PDFLibraryManager'
            ];
            
            AndroidDebug.info(`Testing ${modules.length} modules...`);
            
            modules.forEach(mod => {
                const exists = typeof window[mod] !== 'undefined';
                if (exists) {
                    AndroidDebug.success(`‚úÖ ${mod}: Available`);
                    // Test if module has key methods
                    if (mod === 'PDFGenerator' && window[mod].generateAdvancedPDF) {
                        AndroidDebug.info(`  - generateAdvancedPDF: Available`);
                    }
                    if (mod === 'PDFLibraryManager' && window[mod].getLibraryStatus) {
                        AndroidDebug.info(`  - getLibraryStatus: Available`);
                    }
                } else {
                    AndroidDebug.error(`‚ùå ${mod}: Missing`);
                    
                    // Try to figure out why it's missing
                    if (mod === 'PDFGenerator') {
                        AndroidDebug.info('  Checking if script loaded...');
                        const scripts = Array.from(document.scripts);
                        const pdfScript = scripts.find(s => s.src.includes('pdf-generator.js'));
                        if (pdfScript) {
                            AndroidDebug.info(`  - Script found: ${pdfScript.src}`);
                            AndroidDebug.warn(`  - But PDFGenerator object not created - script error?`);
                        } else {
                            AndroidDebug.error(`  - Script not found in DOM`);
                        }
                    }
                }
            });
            
            // Test App
            if (typeof App !== 'undefined') {
                try {
                    const appInfo = App.getInfo();
                    AndroidDebug.success(`App Version: ${appInfo.version}`);
                    AndroidDebug.info(`Initialized: ${appInfo.initialized}`);
                    
                    if (appInfo.modules) {
                        AndroidDebug.info('App Module Status:');
                        Object.entries(appInfo.modules).forEach(([key, value]) => {
                            AndroidDebug.info(`  ${key}: ${value ? '‚úÖ' : '‚ùå'}`);
                        });
                    }
                } catch (error) {
                    AndroidDebug.error(`App Error: ${error.message}`);
                }
            } else {
                AndroidDebug.error('‚ùå App: Not available');
            }
            
            // Check all loaded scripts
            AndroidDebug.info('=== LOADED SCRIPTS ===');
            const scripts = Array.from(document.scripts);
            const relevantScripts = scripts.filter(s => 
                s.src.includes('.js') && 
                (s.src.includes('assets/js/') || s.src.includes('debug') || s.src.includes('pdf'))
            );
            
            AndroidDebug.info(`Found ${relevantScripts.length} relevant scripts:`);
            relevantScripts.forEach(script => {
                const name = script.src.split('/').pop();
                AndroidDebug.info(`  - ${name}: ${script.src}`);
            });
        }

        function testPDFModules() {
            AndroidDebug.info('=== TESTING PDF MODULES ===');
            
            if (typeof PDFGenerator !== 'undefined') {
                AndroidDebug.success('‚úÖ PDFGenerator: Available');
                
                try {
                    const status = PDFGenerator.getStatus();
                    AndroidDebug.info(`PDF Status: ${JSON.stringify(status)}`);
                } catch (error) {
                    AndroidDebug.error(`PDF Status Error: ${error.message}`);
                }
            } else {
                AndroidDebug.error('‚ùå PDFGenerator: Missing');
            }
            
            if (typeof PDFLibraryManager !== 'undefined') {
                AndroidDebug.success('‚úÖ PDFLibraryManager: Available');
                
                try {
                    const libStatus = PDFLibraryManager.getLibraryStatus();
                    AndroidDebug.info(`Libraries: ${JSON.stringify(libStatus)}`);
                    
                    const testResults = PDFLibraryManager.testLibraries();
                    AndroidDebug.info(`Library Tests: ${JSON.stringify(testResults)}`);
                } catch (error) {
                    AndroidDebug.error(`Library Test Error: ${error.message}`);
                }
            } else {
                AndroidDebug.error('‚ùå PDFLibraryManager: Missing');
            }
            
            // Test current file
            if (typeof ContentRenderer !== 'undefined') {
                const currentFile = ContentRenderer.getCurrentFile();
                AndroidDebug.info(`Current File: ${currentFile || 'None'}`);
            }
        }

        function testMemoryUsage() {
            AndroidDebug.info('=== TESTING MEMORY USAGE ===');
            
            if (performance.memory) {
                const memory = performance.memory;
                AndroidDebug.info(`Used: ${Math.round(memory.usedJSHeapSize / 1024 / 1024)} MB`);
                AndroidDebug.info(`Total: ${Math.round(memory.totalJSHeapSize / 1024 / 1024)} MB`);
                AndroidDebug.info(`Limit: ${Math.round(memory.jsHeapSizeLimit / 1024 / 1024)} MB`);
            } else {
                AndroidDebug.warn('Memory API not available');
            }
            
            // Test DOM elements
            const elements = document.querySelectorAll('*').length;
            AndroidDebug.info(`DOM Elements: ${elements}`);
            
            // Test PDF temp containers
            const tempContainers = document.querySelectorAll('#pdf-temp-container');
            if (tempContainers.length > 0) {
                AndroidDebug.warn(`‚ö†Ô∏è Found ${tempContainers.length} leftover PDF temp containers`);
            } else {
                AndroidDebug.success('‚úÖ No leftover PDF temp containers');
            }
        }

        function clearConsole() {
            document.getElementById('console-output').innerHTML = `
                <div class="log-entry log-info">
                    <span class="log-timestamp">[CLEAR]</span>
                    Console cleared
                </div>
            `;
            logCount = 0;
            errorCount = 0;
            logEntries = [];
            updateStats();
        }

        function exportLogs() {
            const logData = {
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                url: window.location.href,
                sessionDuration: Date.now() - sessionStart,
                logs: logEntries
            };
            
            const blob = new Blob([JSON.stringify(logData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `debug-log-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            AndroidDebug.success('Debug log exported to downloads');
        }

        function goToMainSite() {
            // Open main site in new tab/window
            window.open('index.html', '_blank');
        }

        function updateStats() {
            document.getElementById('log-count').textContent = logCount;
            document.getElementById('error-count').textContent = errorCount;
            
            if (performance.memory) {
                const memory = Math.round(performance.memory.usedJSHeapSize / 1024 / 1024);
                document.getElementById('memory-usage').textContent = memory + ' MB';
            }
            
            const sessionTime = Math.round((Date.now() - sessionStart) / 1000);
            document.getElementById('session-time').textContent = sessionTime + 's';
        }

        // Update stats every 5 seconds
        setInterval(updateStats, 5000);

        // Initialize
        AndroidDebug.info('Android Debug Console ready for tablet debugging');
        AndroidDebug.info('All console.log, console.warn, console.error will appear here');
        AndroidDebug.info('Use test buttons to check module availability and PDF functions');
    </script>
</body>
</html>
