<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 2 Simple Test</title>
    
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Segoe UI', sans-serif;
            background: #f5f5f5;
            padding: 20px;
            line-height: 1.5;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 { color: #2563eb; margin-bottom: 1rem; }
        h2 { color: #059669; margin: 2rem 0 1rem 0; }
        
        .test-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            margin: 0.5rem;
            min-width: 200px;
            display: inline-block;
        }
        
        .test-button:hover { background: #2563eb; }
        .test-button:disabled { background: #9ca3af; cursor: not-allowed; }
        
        .result {
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 6px;
            font-weight: bold;
        }
        
        .success { background: #d1fae5; color: #047857; border: 1px solid #10b981; }
        .error { background: #fee2e2; color: #dc2626; border: 1px solid #ef4444; }
        .info { background: #dbeafe; color: #1d4ed8; border: 1px solid #3b82f6; }
        
        .details {
            background: #f8fafc;
            padding: 1rem;
            border-radius: 6px;
            margin-top: 1rem;
            font-family: monospace;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .back-link {
            display: inline-block;
            margin-top: 2rem;
            color: #2563eb;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border: 1px solid #2563eb;
            border-radius: 6px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Phase 2 Quick Test</h1>
        <p>Yksinkertainen testi tarkistamaan ett√§ Markdown + File Management toimii.</p>

        <div class="result info">
            üí° Vihje: Testaa yksi kerrallaan napeista alla.
        </div>

        <h2>1. Diagnose</h2>
        <button class="test-button" onclick="diagnose()">Tarkista Setup</button>
        <div id="diagnose-result"></div>

        <h2>2. Moduulit</h2>
        <button class="test-button" onclick="testModules()">Testaa JS-tiedostot</button>
        <div id="modules-result"></div>

        <h2>3. Tiedostot</h2>
        <button class="test-button" onclick="testFiles()">Testaa Sis√§lt√∂tiedostot</button>
        <div id="files-result"></div>

        <h2>4. Markdown</h2>
        <button class="test-button" onclick="testMarkdown()">Testaa Markdown</button>
        <div id="markdown-result"></div>

        <h2>5. Kokonaistesti</h2>
        <button class="test-button" onclick="runFullTest()">Suorita Kaikki</button>
        <div id="full-result"></div>

        <a href="index.html" class="back-link">‚Üê Takaisin p√§√§sivulle</a>
    </div>

    <script>
        // Test results storage
        var testResults = {
            modules: false,
            files: false,
            markdown: false
        };

        // Helper function to show results
        function showResult(containerId, success, message, details) {
            var container = document.getElementById(containerId);
            var className = success ? 'success' : 'error';
            var icon = success ? '‚úÖ' : '‚ùå';
            
            var html = '<div class="result ' + className + '">' + icon + ' ' + message + '</div>';
            if (details) {
                html += '<div class="details">' + details + '</div>';
            }
            
            container.innerHTML = html;
        }

        // Diagnose function
        function diagnose() {
            var currentUrl = window.location.href;
            var isGitHubPages = currentUrl.includes('.github.io');
            var isLocalFile = currentUrl.startsWith('file://');
            
            // GitHub Pages behavior: when serving from docs/, the /docs/ part is removed from URL
            var isServingFromDocs = isGitHubPages && !currentUrl.includes('/docs/');
            
            var info = 'Nykyinen URL: ' + currentUrl + '\n';
            info += 'GitHub Pages: ' + (isGitHubPages ? 'Kyll√§' : 'Ei') + '\n';
            info += 'Servaa docs-kansiosta: ' + (isServingFromDocs ? 'Kyll√§ (oikein!)' : 'Ei') + '\n';
            info += 'Paikallinen tiedosto: ' + (isLocalFile ? 'Kyll√§' : 'Ei') + '\n\n';
            
            if (isLocalFile) {
                info += 'ONGELMA: Avaat tiedoston suoraan koneelta.\n';
                info += 'RATKAISU: Lataa GitHubiin ja aktivoi GitHub Pages.';
                showResult('diagnose-result', false, 'Setup-ongelma l√∂ydetty', info);
            } else if (isGitHubPages && isServingFromDocs) {
                info += 'HYV√Ñ: GitHub Pages servaa docs-kansiosta!\n';
                info += 'Tiedostopolut: assets/js/, manifest.json (ei docs/ prefiksi√§)';
                showResult('diagnose-result', true, 'Setup on t√§ydellinen!', info);
            } else if (isGitHubPages) {
                info += 'VAROITUS: GitHub Pages ei k√§yt√§ docs-kansiota.\n';
                info += 'TARKISTA: Repository Settings ‚Üí Pages ‚Üí Source: docs';
                showResult('diagnose-result', true, 'GitHub Pages OK, mutta...', info);
            } else {
                info += 'Ei GitHub Pages - vaikea sanoa polkuja.';
                showResult('diagnose-result', true, 'Tuntematon ymp√§rist√∂', info);
            }
        }

        // Test modules
        function testModules() {
            var currentUrl = window.location.href;
            var isGitHubPages = currentUrl.includes('.github.io');
            var isServingFromDocs = isGitHubPages && !currentUrl.includes('/docs/');
            
            // Determine correct path based on setup
            var basePath = '';
            if (!isGitHubPages || !isServingFromDocs) {
                // If not GitHub Pages serving from docs, try docs/ prefix
                basePath = 'docs/';
            }
            
            showResult('modules-result', false, 'Testaa...', 'Yritet√§√§n ladata JavaScript-tiedostoja...');
            
            // Try to load one module as test
            var script = document.createElement('script');
            script.src = basePath + 'assets/js/debug-logger.js';
            
            script.onload = function() {
                var info = 'Ensimm√§inen moduuli (debug-logger.js) latautui!\n';
                info += 'Polku: ' + basePath + 'assets/js/\n';
                info += 'DEBUG: ' + (typeof DEBUG !== 'undefined' ? 'L√∂ytyi' : 'Ei l√∂ytynyt');
                
                testResults.modules = true;
                showResult('modules-result', true, 'Moduulit toimivat', info);
            };
            
            script.onerror = function() {
                var info = 'Ei voitu ladata: ' + basePath + 'assets/js/debug-logger.js\n';
                info += 'Tarkista ett√§:\n';
                info += '1. Tiedostot ovat GitHubissa\n';
                info += '2. GitHub Pages on aktivoitu\n';
                info += '3. Tiedostot ovat docs/assets/js/ kansiossa\n';
                info += '4. GitHub Pages servaa docs-kansiosta (Settings ‚Üí Pages)';
                
                testResults.modules = false;
                showResult('modules-result', false, 'Moduulien lataus ep√§onnistui', info);
            };
            
            document.head.appendChild(script);
        }

        // Test files
        function testFiles() {
            var currentUrl = window.location.href;
            var isGitHubPages = currentUrl.includes('.github.io');
            var isServingFromDocs = isGitHubPages && !currentUrl.includes('/docs/');
            
            // Determine correct path
            var manifestPath = 'manifest.json';
            if (!isGitHubPages || !isServingFromDocs) {
                manifestPath = 'docs/manifest.json';
            }
            
            showResult('files-result', false, 'Testaa...', 'Yritet√§√§n ladata manifest.json...');
            
            fetch(manifestPath)
                .then(function(response) {
                    if (!response.ok) {
                        throw new Error('HTTP ' + response.status);
                    }
                    return response.json();
                })
                .then(function(data) {
                    var info = 'Manifest ladattu: ' + manifestPath + '\n';
                    info += 'Projekteja: ' + (data.projects ? data.projects.length : 0) + '\n';
                    info += 'JSON koko: ' + JSON.stringify(data).length + ' merkki√§\n';
                    info += 'GitHub Pages servaa docs-kansiosta: ' + (isServingFromDocs ? 'Kyll√§' : 'Ei');
                    
                    testResults.files = true;
                    showResult('files-result', true, 'Tiedostot l√∂ytyv√§t', info);
                })
                .catch(function(error) {
                    var info = 'Manifest ei l√∂ydy: ' + manifestPath + '\n';
                    info += 'Virhe: ' + error.message + '\n';
                    info += 'GitHub Pages setup: ' + (isServingFromDocs ? 'Docs-kansio (oikein)' : 'Ei docs') + '\n';
                    info += 'Tarkista ett√§:\n';
                    info += '1. manifest.json on docs-kansiossa GitHubissa\n';
                    info += '2. GitHub Pages: Settings ‚Üí Pages ‚Üí Source: docs\n';
                    info += '3. Tiedosto on validi JSON';
                    
                    testResults.files = false;
                    showResult('files-result', false, 'Tiedostoja ei l√∂ydy', info);
                });
        }

        // Test markdown
        function testMarkdown() {
            showResult('markdown-result', false, 'Testaa...', 'Testataan markdown render√∂inti√§...');
            
            // Simple markdown test without external dependencies
            var testMd = '# Testi\n\nT√§m√§ on **bold** teksti.';
            var simpleResult = testMd.replace(/^# (.+)$/gm, '<h1>$1</h1>')
                                     .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                                     .replace(/\n\n/g, '</p><p>')
                                     .replace(/^/, '<p>')
                                     .replace(/$/, '</p>');
            
            if (simpleResult.includes('<h1>') && simpleResult.includes('<strong>')) {
                var info = 'Yksinkertainen markdown testi toimii\n';
                info += 'Sy√∂te: ' + testMd + '\n';
                info += 'Tuloste: ' + simpleResult.substring(0, 100) + '...';
                
                testResults.markdown = true;
                showResult('markdown-result', true, 'Markdown perustoiminnot OK', info);
            } else {
                testResults.markdown = false;
                showResult('markdown-result', false, 'Markdown testi ep√§onnistui', 'Yksinkertainen regex-testi ei toiminut');
            }
        }

        // Run full test
        function runFullTest() {
            showResult('full-result', false, 'Testaa...', 'Suoritetaan kaikki testit...');
            
            // Reset results
            testResults = { modules: false, files: false, markdown: false };
            
            // Run tests with delays
            diagnose();
            
            setTimeout(function() {
                testModules();
                
                setTimeout(function() {
                    testFiles();
                    
                    setTimeout(function() {
                        testMarkdown();
                        
                        setTimeout(function() {
                            // Calculate score
                            var passed = 0;
                            var total = 3;
                            
                            if (testResults.modules) passed++;
                            if (testResults.files) passed++;
                            if (testResults.markdown) passed++;
                            
                            var percentage = Math.round((passed / total) * 100);
                            var message = '';
                            var success = false;
                            
                            if (percentage >= 100) {
                                message = 'üéâ Phase 2 toimii t√§ydellisesti! (' + passed + '/' + total + ')';
                                success = true;
                            } else if (percentage >= 66) {
                                message = '‚ö†Ô∏è Phase 2 toimii osittain (' + passed + '/' + total + ')';
                                success = true;
                            } else {
                                message = '‚ùå Phase 2 ei toimi kunnolla (' + passed + '/' + total + ')';
                                success = false;
                            }
                            
                            var info = 'Kokonaispistem√§√§r√§: ' + percentage + '%\n';
                            info += 'Moduulit: ' + (testResults.modules ? '‚úÖ' : '‚ùå') + '\n';
                            info += 'Tiedostot: ' + (testResults.files ? '‚úÖ' : '‚ùå') + '\n';
                            info += 'Markdown: ' + (testResults.markdown ? '‚úÖ' : '‚ùå');
                            
                            showResult('full-result', success, message, info);
                        }, 1000);
                    }, 1000);
                }, 1000);
            }, 1000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Simple test page loaded');
        });
    </script>
</body>
</html>
