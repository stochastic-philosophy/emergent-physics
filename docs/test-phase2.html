<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 2 Simple Test</title>
    
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Segoe UI', sans-serif;
            background: #f5f5f5;
            padding: 20px;
            line-height: 1.5;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 { color: #2563eb; margin-bottom: 1rem; }
        h2 { color: #059669; margin: 2rem 0 1rem 0; }
        
        .test-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            margin: 0.5rem;
            min-width: 200px;
        }
        
        .test-button:hover { background: #2563eb; }
        .test-button:disabled { background: #9ca3af; cursor: not-allowed; }
        
        .result {
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 6px;
            font-weight: bold;
        }
        
        .success { background: #d1fae5; color: #047857; border: 1px solid #10b981; }
        .error { background: #fee2e2; color: #dc2626; border: 1px solid #ef4444; }
        .info { background: #dbeafe; color: #1d4ed8; border: 1px solid #3b82f6; }
        
        .score {
            font-size: 2rem;
            text-align: center;
            padding: 2rem;
            border-radius: 12px;
            margin: 2rem 0;
        }
        
        .back-link {
            display: inline-block;
            margin-top: 2rem;
            color: #2563eb;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border: 1px solid #2563eb;
            border-radius: 6px;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .details {
            background: #f8fafc;
            padding: 1rem;
            border-radius: 6px;
            margin-top: 1rem;
            font-family: monospace;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Phase 2 Quick Test</h1>
        <p>Yksinkertainen testi tarkistamaan ett√§ Markdown + File Management toimii.</p>

        <h2>1. Perusmoduulit</h2>
        <button class="test-button" onclick="testModules()">Testaa Moduulit</button>
        <div id="modules-result"></div>

        <h2>2. Tiedostojen lataus</h2>
        <button class="test-button" onclick="testFiles()">Testaa Tiedostot</button>
        <div id="files-result"></div>

        <h2>3. Markdown rendering</h2>
        <button class="test-button" onclick="testMarkdown()">Testaa Markdown</button>
        <div id="markdown-result"></div>

        <h2>4. Kokonaistesti</h2>
        <button class="test-button" onclick="runFullTest()">Suorita Kaikki Testit</button>
        <div id="full-result"></div>

        <div id="final-score" style="display: none;"></div>

        <a href="index.html" class="back-link">‚Üê Takaisin p√§√§sivulle</a>
    </div>

    <script>
        let testResults = {
            modules: false,
            files: false,
            markdown: false
        };

        function showResult(containerId, success, message, details = '') {
            const container = document.getElementById(containerId);
            const className = success ? 'success' : 'error';
            
            let html = `<div class="result ${className}">${success ? '‚úÖ' : '‚ùå'} ${message}</div>`;
            if (details) {
                html += `<div class="details">${details}</div>`;
            }
            
            container.innerHTML = html;
        }

        function showLoading(containerId, message) {
            const container = document.getElementById(containerId);
            container.innerHTML = `<div class="result info">${message} <span class="loading"></span></div>`;
        }

        async function testModules() {
            showLoading('modules-result', 'Lataan moduuleja...');
            
            try {
                // Load modules in order
                await loadScript('assets/js/debug-logger.js');
                await loadScript('assets/js/utils.js');
                await loadScript('assets/js/storage.js');
                await loadScript('assets/js/ui.js');
                await loadScript('assets/js/theme-manager.js');
                await loadScript('assets/js/file-manager.js');
                await loadScript('assets/js/markdown-processor.js');
                await loadScript('assets/js/app.js');

                // Quick check
                const modulesOk = typeof DEBUG !== 'undefined' && 
                                 typeof Utils !== 'undefined' && 
                                 typeof FileManager !== 'undefined' &&
                                 typeof MarkdownProcessor !== 'undefined';

                if (modulesOk) {
                    testResults.modules = true;
                    showResult('modules-result', true, 'Kaikki moduulit ladattu onnistuneesti!');
                } else {
                    throw new Error('Joitain moduuleja puuttuu');
                }
            } catch (error) {
                testResults.modules = false;
                showResult('modules-result', false, 'Moduulien lataus ep√§onnistui', error.message);
            }
        }

        async function testFiles() {
            showLoading('files-result', 'Testataan tiedostojen latausta...');
            
            try {
                // Test manifest
                const manifestResponse = await fetch('manifest.json');
                if (!manifestResponse.ok) throw new Error('manifest.json ei l√∂ydy');
                
                const manifest = await manifestResponse.json();
                if (!manifest.projects || manifest.projects.length === 0) {
                    throw new Error('manifest.json ei sis√§ll√§ projekteja');
                }

                // Test markdown file
                const mdResponse = await fetch('projects/indivisible-stochastic-processes/fi/documentation/overview_project.md');
                if (!mdResponse.ok) throw new Error('overview_project.md ei l√∂ydy');
                
                const mdContent = await mdResponse.text();
                if (!mdContent.includes('Indivisible Stochastic Processes')) {
                    throw new Error('Markdown-tiedosto ei sis√§ll√§ odotettua teksti√§');
                }

                testResults.files = true;
                showResult('files-result', true, 'Tiedostot ladattu onnistuneesti!', 
                    `Manifest: ${manifest.projects.length} projektia\nMarkdown: ${mdContent.length} merkki√§`);
                
            } catch (error) {
                testResults.files = false;
                showResult('files-result', false, 'Tiedostojen lataus ep√§onnistui', error.message);
            }
        }

        async function testMarkdown() {
            showLoading('markdown-result', 'Testataan Markdown-render√∂inti√§...');
            
            try {
                if (typeof MarkdownProcessor === 'undefined') {
                    throw new Error('MarkdownProcessor ei ole ladattu');
                }

                // Load external libraries
                await loadScript('https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js');
                
                // Wait a moment for marked to initialize
                await new Promise(resolve => setTimeout(resolve, 500));
                
                if (typeof marked === 'undefined') {
                    throw new Error('Marked.js ei ladannut');
                }

                // Test basic markdown
                const testMd = '# Testi\n\nT√§m√§ on **lihavoitua** teksti√§.';
                const result = MarkdownProcessor.renderMarkdown(testMd);
                
                if (!result.includes('<h1>') || !result.includes('<strong>')) {
                    throw new Error('Markdown ei render√∂idy oikein');
                }

                testResults.markdown = true;
                showResult('markdown-result', true, 'Markdown render√∂inti toimii!', 
                    `Tuotos: ${result.substring(0, 100)}...`);
                
            } catch (error) {
                testResults.markdown = false;
                showResult('markdown-result', false, 'Markdown render√∂inti ep√§onnistui', error.message);
            }
        }

        async function runFullTest() {
            showLoading('full-result', 'Suoritan kokonaistesti√§...');
            
            // Run all tests in sequence
            await testModules();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testFiles();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testMarkdown();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // Calculate final score
            const passed = Object.values(testResults).filter(Boolean).length;
            const total = Object.keys(testResults).length;
            const percentage = Math.round((passed / total) * 100);
            
            let message, className;
            if (percentage >= 100) {
                message = `üéâ Phase 2 toimii t√§ydellisesti! (${passed}/${total})`;
                className = 'success';
            } else if (percentage >= 66) {
                message = `‚ö†Ô∏è Phase 2 toimii osittain (${passed}/${total})`;
                className = 'info';
            } else {
                message = `‚ùå Phase 2 ei toimi kunnolla (${passed}/${total})`;
                className = 'error';
            }
            
            showResult('full-result', percentage >= 66, message);
            
            // Show final score
            const scoreDiv = document.getElementById('final-score');
            scoreDiv.innerHTML = `
                <div class="score ${className}">
                    Phase 2 Score: ${percentage}%<br>
                    <small>(${passed}/${total} testi√§ l√§p√§isi)</small>
                </div>
            `;
            scoreDiv.style.display = 'block';
        }

        function loadScript(src) {
            return new Promise((resolve, reject) => {
                // Check if already loaded
                if (document.querySelector(`script[src="${src}"]`)) {
                    resolve();
                    return;
                }
                
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = () => reject(new Error(`Failed to load ${src}`));
                document.head.appendChild(script);
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Add some helpful info
            const container = document.querySelector('.container');
            const info = document.createElement('div');
            info.className = 'result info';
            info.innerHTML = 'üí° Vihje: Testaa yksi kerrallaan tai k√§yt√§ "Suorita Kaikki Testit" -nappia.';
            container.insertBefore(info, container.querySelector('h2'));
        });
    </script>
</body>
</html>
