<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Theme Debug Test</title>
    
    <style>
        body {
            font-family: sans-serif;
            padding: 2rem;
            transition: all 0.3s ease;
        }
        
        .debug-panel {
            background: #f5f5f5;
            border: 1px solid #ccc;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }
        
        .theme-test {
            padding: 2rem;
            margin: 1rem 0;
            border: 2px solid;
            border-radius: 8px;
        }
        
        /* Light theme */
        body.theme-light {
            background: #ffffff;
            color: #1f2937;
        }
        
        body.theme-light .theme-test {
            background: #f8fafc;
            border-color: #2563eb;
            color: #1f2937;
        }
        
        /* Dark theme */
        body.theme-dark {
            background: #0f172a;
            color: #f1f5f9;
        }
        
        body.theme-dark .theme-test {
            background: #1e293b;
            border-color: #3b82f6;
            color: #f1f5f9;
        }
        
        body.theme-dark .debug-panel {
            background: #334155;
            border-color: #475569;
            color: #e2e8f0;
        }
        
        button {
            padding: 0.75rem 1.5rem;
            margin: 0.5rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .theme-btn {
            background: #2563eb;
            color: white;
        }
        
        .debug-btn {
            background: #059669;
            color: white;
        }
        
        .test-btn {
            background: #dc2626;
            color: white;
        }
        
        #debug-log {
            background: #000;
            color: #0f0;
            padding: 1rem;
            font-family: monospace;
            font-size: 12px;
            height: 200px;
            overflow-y: auto;
            border-radius: 4px;
        }
    </style>
</head>
<body class="theme-light">
    <h1>üêõ Theme Debug Test</h1>
    
    <div class="debug-panel">
        <h3>Controls</h3>
        <button class="theme-btn" onclick="toggleTheme()">Toggle Theme</button>
        <button class="debug-btn" onclick="runDiagnostics()">Run Diagnostics</button>
        <button class="test-btn" onclick="clearLog()">Clear Log</button>
    </div>
    
    <div class="theme-test">
        <h2>Theme Test Area</h2>
        <p>This area should change colors based on theme.</p>
        <p><strong>Current body classes:</strong> <span id="current-classes"></span></p>
        <p><strong>LocalStorage theme:</strong> <span id="storage-theme"></span></p>
    </div>
    
    <div class="debug-panel">
        <h3>Debug Log</h3>
        <div id="debug-log"></div>
    </div>

    <script>
        let currentTheme = 'light';
        
        function log(message) {
            const now = new Date().toLocaleTimeString();
            const logElement = document.getElementById('debug-log');
            logElement.innerHTML += `[${now}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }
        
        function updateDisplay() {
            document.getElementById('current-classes').textContent = document.body.className;
            document.getElementById('storage-theme').textContent = localStorage.getItem('theme') || 'null';
        }
        
        function toggleTheme() {
            log('=== TOGGLE THEME CLICKED ===');
            
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            log(`Switching from ${currentTheme} to ${newTheme}`);
            
            // Update current theme
            currentTheme = newTheme;
            
            // Update localStorage
            localStorage.setItem('theme', newTheme);
            log(`Saved to localStorage: ${newTheme}`);
            
            // Update body class
            document.body.className = document.body.className.replace(/theme-\w+/g, '');
            document.body.classList.add(`theme-${newTheme}`);
            log(`Applied body class: theme-${newTheme}`);
            
            // Check if CSS took effect
            const computedStyle = getComputedStyle(document.body);
            log(`Body background color: ${computedStyle.backgroundColor}`);
            log(`Body color: ${computedStyle.color}`);
            
            updateDisplay();
            log(`Theme switch completed to: ${newTheme}`);
        }
        
        function runDiagnostics() {
            log('=== RUNNING DIAGNOSTICS ===');
            
            // Check localStorage
            const storedTheme = localStorage.getItem('theme');
            log(`LocalStorage theme: ${storedTheme}`);
            
            // Check body classes
            log(`Body className: "${document.body.className}"`);
            log(`Body classList: [${Array.from(document.body.classList).join(', ')}]`);
            
            // Check CSS
            const computedStyle = getComputedStyle(document.body);
            log(`Computed background: ${computedStyle.backgroundColor}`);
            log(`Computed color: ${computedStyle.color}`);
            
            // Check theme-specific elements
            const themeTest = document.querySelector('.theme-test');
            if (themeTest) {
                const testStyle = getComputedStyle(themeTest);
                log(`Theme test background: ${testStyle.backgroundColor}`);
                log(`Theme test border-color: ${testStyle.borderColor}`);
            }
            
            // Test CSS rule detection
            const hasLightTheme = document.styleSheets[0] ? 
                Array.from(document.styleSheets[0].cssRules).some(rule => 
                    rule.selectorText && rule.selectorText.includes('.theme-light')
                ) : false;
            log(`CSS contains .theme-light rules: ${hasLightTheme}`);
            
            updateDisplay();
            log('=== DIAGNOSTICS COMPLETE ===');
        }
        
        function clearLog() {
            document.getElementById('debug-log').innerHTML = '';
        }
        
        // Initialize
        window.addEventListener('load', function() {
            log('Page loaded');
            
            // Check initial state
            const storedTheme = localStorage.getItem('theme');
            if (storedTheme) {
                log(`Found stored theme: ${storedTheme}`);
                currentTheme = storedTheme;
                document.body.className = `theme-${currentTheme}`;
                log(`Applied stored theme: ${currentTheme}`);
            }
            
            updateDisplay();
            runDiagnostics();
        });
    </script>
</body>
</html>
