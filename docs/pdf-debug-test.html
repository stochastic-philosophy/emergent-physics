<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Debug Test</title>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .debug-info {
            background: #1a1a1a;
            color: #00ff00;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin: 10px 0;
        }
        
        .test-content {
            background: white;
            padding: 20px;
            border: 2px solid #007cba;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .test-btn {
            background: #dc2626;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        
        .test-btn:hover {
            background: #b91c1c;
        }
        
        h1 { color: #333; }
        h2 { color: #666; }
        
        .math-test {
            margin: 20px 0;
            text-align: center;
            font-size: 18px;
        }
        
        .code-test {
            background: #f8f8f8;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        
        th {
            background: #f0f0f0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üêõ PDF Debug Test</h1>
        <p>Testaa PDF-generaattoria ja katso debug-lokeja</p>
        
        <div>
            <button class="test-btn" onclick="testBasicPDF()">üìÑ Test Basic PDF</button>
            <button class="test-btn" onclick="testContentFind()">üîç Test Content Finding</button>
            <button class="test-btn" onclick="clearDebug()">üóëÔ∏è Clear Debug</button>
        </div>
        
        <div id="debug-output" class="debug-info">
            [DEBUG] PDF Debug Test initialized...<br>
        </div>
        
        <!-- Test content that will be converted to PDF -->
        <div class="test-content" id="main-markdown-content">
            <h1>Test Document for PDF</h1>
            <p>This is a test document to debug PDF generation issues.</p>
            
            <h2>Mathematical Formula Test</h2>
            <div class="math-test">
                Formula: E = mc¬≤ (should appear in PDF)
            </div>
            
            <h2>Code Block Test</h2>
            <div class="code-test">
def hello_world():
    print("Hello, PDF World!")
    return "PDF generation test"
            </div>
            
            <h2>Table Test</h2>
            <table>
                <tr><th>Feature</th><th>Status</th></tr>
                <tr><td>Text rendering</td><td>‚úÖ Working</td></tr>
                <tr><td>Code highlighting</td><td>üß™ Testing</td></tr>
                <tr><td>LaTeX math</td><td>üß™ Testing</td></tr>
            </table>
            
            <h2>List Test</h2>
            <ul>
                <li>First item in PDF</li>
                <li>Second item in PDF</li>
                <li>Third item with <strong>bold text</strong></li>
            </ul>
            
            <blockquote>
                This is a blockquote that should appear in the PDF with proper styling.
            </blockquote>
        </div>
    </div>

    <script>
        // Simple debug logger
        function debugLog(message) {
            const debugOutput = document.getElementById('debug-output');
            const timestamp = new Date().toLocaleTimeString();
            debugOutput.innerHTML += `[${timestamp}] ${message}<br>`;
            debugOutput.scrollTop = debugOutput.scrollHeight;
            console.log(`[PDF DEBUG] ${message}`);
        }
        
        function clearDebug() {
            document.getElementById('debug-output').innerHTML = '[DEBUG] Log cleared...<br>';
        }
        
        function testContentFind() {
            debugLog('=== TESTING CONTENT FINDING ===');
            
            const selectors = [
                '#main-markdown-content',
                '.test-content',
                '.markdown-content',
                '#main-content'
            ];
            
            selectors.forEach(selector => {
                const element = document.querySelector(selector);
                if (element) {
                    debugLog(`‚úÖ Found: ${selector} (${element.innerHTML.length} chars)`);
                    debugLog(`   Content preview: ${element.innerHTML.substring(0, 100)}...`);
                } else {
                    debugLog(`‚ùå Not found: ${selector}`);
                }
            });
            
            debugLog('Content finding test completed');
        }
        
        async function testBasicPDF() {
            debugLog('=== STARTING PDF GENERATION TEST ===');
            
            try {
                // Test 1: Check if html2pdf is available
                debugLog('Loading html2pdf.js...');
                await loadHtml2PDF();
                debugLog('‚úÖ html2pdf.js loaded successfully');
                
                // Test 2: Find content element
                const contentElement = document.getElementById('main-markdown-content');
                if (!contentElement) {
                    throw new Error('Content element not found');
                }
                debugLog(`‚úÖ Content element found: ${contentElement.innerHTML.length} characters`);
                
                // Test 3: Clone and prepare content
                const clonedContent = contentElement.cloneNode(true);
                debugLog(`‚úÖ Content cloned: ${clonedContent.innerHTML.length} characters`);
                
                // Test 4: Create temp container
                const tempContainer = document.createElement('div');
                tempContainer.id = 'pdf-temp-container';
                tempContainer.style.cssText = `
                    position: fixed !important;
                    top: 0 !important;
                    left: 0 !important;
                    width: 794px !important;
                    min-height: 1000px !important;
                    background: white !important;
                    font-family: Arial, sans-serif !important;
                    line-height: 1.6 !important;
                    color: #000 !important;
                    padding: 20px !important;
                    z-index: -9999 !important;
                    opacity: 0.01 !important;
                `;
                
                tempContainer.appendChild(clonedContent);
                document.body.appendChild(tempContainer);
                debugLog(`‚úÖ Temp container created and added to DOM`);
                
                // Wait for rendering
                await new Promise(resolve => setTimeout(resolve, 1000));
                debugLog('‚úÖ Waited 1000ms for rendering');
                
                // Test 5: Generate PDF
                debugLog('Starting PDF generation...');
                const options = {
                    margin: [10, 10, 10, 10],
                    filename: 'debug-test.pdf',
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { 
                        scale: 2,
                        useCORS: true,
                        allowTaint: true,
                        backgroundColor: '#ffffff',
                        logging: true,
                        width: tempContainer.scrollWidth,
                        height: tempContainer.scrollHeight
                    },
                    jsPDF: { 
                        unit: 'mm', 
                        format: 'a4', 
                        orientation: 'portrait'
                    }
                };
                
                await window.html2pdf()
                    .set(options)
                    .from(tempContainer)
                    .save();
                
                debugLog('üéâ PDF generation completed successfully!');
                
                // Cleanup
                document.body.removeChild(tempContainer);
                debugLog('‚úÖ Cleanup completed');
                
            } catch (error) {
                debugLog(`‚ùå ERROR: ${error.message}`);
                debugLog(`   Stack: ${error.stack}`);
            }
        }
        
        function loadHtml2PDF() {
            return new Promise((resolve, reject) => {
                if (typeof window.html2pdf !== 'undefined') {
                    resolve();
                    return;
                }
                
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js';
                script.onload = () => {
                    debugLog('html2pdf.js script loaded from CDN');
                    resolve();
                };
                script.onerror = () => {
                    debugLog('Failed to load html2pdf.js from CDN');
                    reject(new Error('Failed to load html2pdf.js'));
                };
                document.head.appendChild(script);
            });
        }
        
        // Initialize
        debugLog('PDF Debug Test page loaded');
        debugLog('Click "Test Content Finding" to see what elements are available');
        debugLog('Click "Test Basic PDF" to try generating a simple PDF');
    </script>
</body>
</html>
