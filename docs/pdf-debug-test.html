<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Debug Test - FIXED</title>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .debug-info {
            background: #1a1a1a;
            color: #00ff00;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin: 10px 0;
        }
        
        .test-content {
            background: white;
            padding: 20px;
            border: 2px solid #007cba;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .test-btn {
            background: #dc2626;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        
        .test-btn:hover {
            background: #b91c1c;
        }
        
        .success-btn {
            background: #059669;
        }
        
        .success-btn:hover {
            background: #047857;
        }
        
        h1 { color: #333; }
        h2 { color: #666; }
        
        .math-test {
            margin: 20px 0;
            text-align: center;
            font-size: 18px;
        }
        
        .code-test {
            background: #f8f8f8;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        
        th {
            background: #f0f0f0;
        }
        
        /* Temp container for PDF - VISIBLE VERSION */
        .pdf-temp-visible {
            position: absolute !important;
            top: 50px !important;
            left: 50px !important;
            width: 794px !important;
            min-height: 600px !important;
            background: white !important;
            font-family: Arial, sans-serif !important;
            line-height: 1.6 !important;
            color: #000 !important;
            padding: 20px !important;
            border: 3px solid red !important;
            z-index: 1000 !important;
            opacity: 1 !important;
        }
        
        .status-indicator {
            background: #e0f7fa;
            border: 1px solid #00acc1;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üêõ PDF Debug Test - VISIBILITY FIXED</h1>
        <p>Testaa PDF-generaattoria n√§kyv√§ll√§ elementill√§</p>
        
        <div class="status-indicator">
            <strong>üîß MUUTOS:</strong> Temp-elementti on nyt t√§ysin n√§kyv√§ PDF-generoinnin aikana (punainen reunus)
        </div>
        
        <div>
            <button class="test-btn" onclick="testVisiblePDF()">üìÑ Test Visible PDF</button>
            <button class="test-btn" onclick="testContentFind()">üîç Test Content Finding</button>
            <button class="success-btn" onclick="testHtml2Canvas()">üñºÔ∏è Test html2canvas</button>
            <button class="test-btn" onclick="clearDebug()">üóëÔ∏è Clear Debug</button>
        </div>
        
        <div id="debug-output" class="debug-info">
            [DEBUG] PDF Debug Test (VISIBILITY FIXED) initialized...<br>
        </div>
        
        <!-- Test content that will be converted to PDF -->
        <div class="test-content" id="main-markdown-content">
            <h1>Test Document for PDF (Visible Version)</h1>
            <p>This is a test document with FULL VISIBILITY during PDF generation.</p>
            
            <h2>Mathematical Formula Test</h2>
            <div class="math-test">
                Formula: E = mc¬≤ (should appear in PDF)
            </div>
            
            <h2>Code Block Test</h2>
            <div class="code-test">
def hello_world():
    print("Hello, PDF World!")
    return "PDF generation test"
            </div>
            
            <h2>Table Test</h2>
            <table>
                <tr><th>Feature</th><th>Status</th></tr>
                <tr><td>Text rendering</td><td>‚úÖ Working</td></tr>
                <tr><td>Code highlighting</td><td>üß™ Testing</td></tr>
                <tr><td>LaTeX math</td><td>üß™ Testing</td></tr>
            </table>
            
            <h2>List Test</h2>
            <ul>
                <li>First item in PDF</li>
                <li>Second item in PDF</li>
                <li>Third item with <strong>bold text</strong></li>
            </ul>
            
            <blockquote>
                This is a blockquote that should appear in the PDF with proper styling.
            </blockquote>
            
            <p style="color: red; font-weight: bold; font-size: 18px;">
                üö® RED TEXT TEST - This should be visible in PDF! üö®
            </p>
        </div>
    </div>

    <script>
        let tempContainer = null;
        
        // Simple debug logger
        function debugLog(message) {
            const debugOutput = document.getElementById('debug-output');
            const timestamp = new Date().toLocaleTimeString();
            debugOutput.innerHTML += `[${timestamp}] ${message}<br>`;
            debugOutput.scrollTop = debugOutput.scrollHeight;
            console.log(`[PDF DEBUG] ${message}`);
        }
        
        function clearDebug() {
            document.getElementById('debug-output').innerHTML = '[DEBUG] Log cleared...<br>';
        }
        
        function testContentFind() {
            debugLog('=== TESTING CONTENT FINDING ===');
            
            const selectors = [
                '#main-markdown-content',
                '.test-content',
                '.markdown-content',
                '#main-content'
            ];
            
            selectors.forEach(selector => {
                const element = document.querySelector(selector);
                if (element) {
                    debugLog(`‚úÖ Found: ${selector} (${element.innerHTML.length} chars)`);
                    debugLog(`   Content preview: ${element.innerHTML.substring(0, 100)}...`);
                } else {
                    debugLog(`‚ùå Not found: ${selector}`);
                }
            });
            
            debugLog('Content finding test completed');
        }
        
        async function testHtml2Canvas() {
            debugLog('=== TESTING HTML2CANVAS SEPARATELY ===');
            
            try {
                await loadHtml2Canvas();
                debugLog('‚úÖ html2canvas loaded');
                
                const contentElement = document.getElementById('main-markdown-content');
                debugLog(`‚úÖ Content element: ${contentElement.innerHTML.length} chars`);
                
                debugLog('üì∏ Taking screenshot with html2canvas...');
                const canvas = await window.html2canvas(contentElement, {
                    backgroundColor: '#ffffff',
                    logging: true
                });
                
                debugLog(`‚úÖ Canvas created: ${canvas.width}x${canvas.height}`);
                
                if (canvas.width > 0 && canvas.height > 0) {
                    debugLog('üéâ html2canvas SUCCESS - canvas has content!');
                    
                    // Show the canvas as image for verification
                    const imgData = canvas.toDataURL();
                    const img = document.createElement('img');
                    img.src = imgData;
                    img.style.cssText = 'max-width: 400px; border: 2px solid green; margin: 10px 0;';
                    document.querySelector('.test-container').appendChild(img);
                    debugLog('‚úÖ Canvas image added to page for verification');
                } else {
                    debugLog('‚ùå html2canvas FAILED - empty canvas');
                }
                
            } catch (error) {
                debugLog(`‚ùå html2canvas ERROR: ${error.message}`);
            }
        }
        
        async function testVisiblePDF() {
            debugLog('=== STARTING VISIBLE PDF GENERATION TEST ===');
            
            try {
                // Test 1: Load libraries
                debugLog('Loading html2pdf.js...');
                await loadHtml2PDF();
                debugLog('‚úÖ html2pdf.js loaded successfully');
                
                // Test 2: Find content element
                const contentElement = document.getElementById('main-markdown-content');
                if (!contentElement) {
                    throw new Error('Content element not found');
                }
                debugLog(`‚úÖ Content element found: ${contentElement.innerHTML.length} characters`);
                
                // Test 3: Clone and prepare content
                const clonedContent = contentElement.cloneNode(true);
                debugLog(`‚úÖ Content cloned: ${clonedContent.innerHTML.length} characters`);
                
                // Test 4: Create VISIBLE temp container
                tempContainer = document.createElement('div');
                tempContainer.id = 'pdf-temp-container';
                tempContainer.className = 'pdf-temp-visible';
                
                // Add title
                const title = document.createElement('h1');
                title.textContent = 'üìÑ PDF Test Document';
                title.style.cssText = 'color: #000 !important; margin-bottom: 20px !important;';
                tempContainer.appendChild(title);
                tempContainer.appendChild(clonedContent);
                
                document.body.appendChild(tempContainer);
                debugLog(`‚úÖ VISIBLE temp container created (red border should be visible on page)`);
                
                // Wait for rendering
                debugLog('‚è±Ô∏è Waiting 2 seconds for visible rendering...');
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                debugLog(`‚úÖ Container dimensions: ${tempContainer.scrollWidth}x${tempContainer.scrollHeight}`);
                
                // Test 5: Generate PDF from VISIBLE element
                debugLog('üìÑ Starting PDF generation from VISIBLE element...');
                const options = {
                    margin: [5, 5, 5, 5],
                    filename: 'visible-debug-test.pdf',
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { 
                        scale: 1,
                        useCORS: true,
                        allowTaint: true,
                        backgroundColor: '#ffffff',
                        logging: true,
                        width: tempContainer.scrollWidth,
                        height: tempContainer.scrollHeight
                    },
                    jsPDF: { 
                        unit: 'mm', 
                        format: 'a4', 
                        orientation: 'portrait'
                    }
                };
                
                await window.html2pdf()
                    .set(options)
                    .from(tempContainer)
                    .save();
                
                debugLog('üéâ VISIBLE PDF generation completed!');
                debugLog('üì• Check your downloads for "visible-debug-test.pdf"');
                
                // Keep container visible for a moment
                debugLog('‚è±Ô∏è Keeping temp container visible for 3 more seconds...');
                await new Promise(resolve => setTimeout(resolve, 3000));
                
                // Cleanup
                document.body.removeChild(tempContainer);
                tempContainer = null;
                debugLog('‚úÖ Cleanup completed');
                
            } catch (error) {
                debugLog(`‚ùå ERROR: ${error.message}`);
                debugLog(`   Stack: ${error.stack}`);
                
                // Cleanup on error
                if (tempContainer && tempContainer.parentNode) {
                    document.body.removeChild(tempContainer);
                    tempContainer = null;
                }
            }
        }
        
        function loadHtml2PDF() {
            return new Promise((resolve, reject) => {
                if (typeof window.html2pdf !== 'undefined') {
                    resolve();
                    return;
                }
                
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js';
                script.onload = () => {
                    debugLog('html2pdf.js script loaded from CDN');
                    resolve();
                };
                script.onerror = () => {
                    debugLog('Failed to load html2pdf.js from CDN');
                    reject(new Error('Failed to load html2pdf.js'));
                };
                document.head.appendChild(script);
            });
        }
        
        function loadHtml2Canvas() {
            return new Promise((resolve, reject) => {
                if (typeof window.html2canvas !== 'undefined') {
                    resolve();
                    return;
                }
                
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
                script.onload = () => {
                    debugLog('html2canvas script loaded from CDN');
                    resolve();
                };
                script.onerror = () => {
                    debugLog('Failed to load html2canvas from CDN');
                    reject(new Error('Failed to load html2canvas'));
                };
                document.head.appendChild(script);
            });
        }
        
        // Initialize
        debugLog('PDF Debug Test (VISIBILITY FIXED) page loaded');
        debugLog('üîß NEW: Temp container will be FULLY VISIBLE with red border');
        debugLog('üì± Click "Test Visible PDF" to generate PDF from visible element');
        debugLog('üñºÔ∏è Click "Test html2canvas" to test screenshot separately');
    </script>
</body>
</html>
